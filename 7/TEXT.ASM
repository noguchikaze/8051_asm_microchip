ORG	00H
JMP	PRE
ORG	50H

;P1=KEY
;P0
PRE:
	MOV	DPTR,#TABLE
START:
	MOV	R0,#01111111B
	MOV	R1,#0	;ROW COUNTER
	MOV	R2,#0	;INDEX FOR ROW
ROW:
	MOV	P1,R0		;CHECK ROW
	CALL	DELAY
	MOV	A,P1
	ANL	A,#00001111B	;CHECK IF KEY IS PRESSED

	INC	R1		;ROW COUNTER++

	CJNE	A,#00001111B,COL1

;=========在沒有按鍵按下的情況==============================

	MOV	A,R0
	RR	A
	MOV	R0,A

	MOV	A,R2
	ADD	A,#4		;INDEX FOR ROW +4
	MOV	R2,A

	CJNE	R1,#4,ROW
;==========掃完每一列以後===================================

	JMP	START	;從頭開始掃描	

;==========掃描完後,A有四種狀況: 0111 1011 1101 1110==============

COL1:
	CJNE	A,#00001110B,COL2
	MOV	R3,#0	;FOR INDEX
	JMP	SHOW
COL2:
	CJNE	A,#00001101B,COL3
	MOV	R3,#1	;FOR INDEX
	JMP	SHOW
COL3:
	CJNE	A,#00001011B,COL4
	MOV	R3,#2	;FOR INDEX
	JMP	SHOW
COL4:
	CJNE	A,#00000111B,START
	MOV	R3,#3	;FOR INDEX
	JMP	SHOW
	
SHOW:
	MOV	A,R2	;MOV INDEX INTO A
	ADD	A,R3	;ADD THE INDEX OF COL
	MOVC	A,@A+DPTR
OVER:
	MOV	P2,A	;輸出至七段顯示器
	JMP	START	;從頭開始掃描

DELAY:
	MOV	R5,#100
DELAY1:
	MOV	R6,#150
DELAY2:
	DJNZ	R6,DELAY2
	DJNZ	R5,DELAY1
	RET
;===================TABLE=====================
TABLE:
	DB	11100000B,11100001B,11100010B,11100011B
	DB	11100100B,11100101B,11100110B,11100111B
	DB	11101000B,11101001B,11110000B,11110000B
	DB	11110000B,11110000B,11110000B,11110000B