;16x2 LCD造字練習程式

LCD_RS		EQU	P1.0		;定義LCD接線位置
LCD_RW		EQU	P1.1
LCD_E		EQU	P1.2
LCD_DATA	EQU	P2
		ORG 00H
		JMP START
		ORG 50H
START:
;		MOV	R5,#1		;如果電源關掉重開時,LCD無法正常顯示
;		CALL	DELAY		;請加上此延遲程式
		MOV R3,#0

		CLR	LCD_RW		;習慣上直接將LCD的RW接腳直接接地，
	   	
		MOV	A,#00111000B	;設定LCD介面為8位元, 2行, 5x7字型
		CALL	COMMAND
		MOV	A,#00001100B	;設定要LCD顯示, 要有游標, 要閃爍
		CALL	COMMAND
		MOV	A,#00000110B	;設定寫資料進入LCD時, 顯示器不要動, 游標向右移一格
		CALL	COMMAND
REPAINT:
		MOV	A,#1		;清除LCD
		CALL	COMMAND

		MOV	R5,#1		;延遲等清除LCD命令處理完畢
		CALL	DELAY

		MOV	A,#01000000B	;設定寫入字型資料, 從第一字的第一行開始
		CALL	COMMAND

		CALL	SET_FONT	;寫入字型資料	

		MOV	A,#10000000B	;游標移到第一行開頭
		CALL	COMMAND

		MOV	A,#00000000B
SHOW:
		CALL	WRDR
		INC A
		CJNE A,#7,SHOW
		
		INC R3
		CALL DELAY

		
		CJNE R3	,#4,REPAINT
		MOV R3,#0

		JMP	REPAINT

;----------------------------------------------------------------------------
SET_FONT:				;造字副程式
ONEP:
		CJNE R3,#0,TWOP
		MOV	DPTR,#TABLE1	;指標指到字型表開頭
		MOV	R6,#8*7	;一個字8筆資料, n個字共 8 x n 筆資料	
TWOP:
		CJNE R3,#1,THREEP
		MOV	DPTR,#TABLE2	;指標指到字型表開頭
		MOV	R6,#8*7	;一個字8筆資料, n個字共 8 x n 筆資料
THREEP:
		CJNE R3,#2,FOURP
		MOV	DPTR,#TABLE3	;指標指到字型表開頭
		MOV	R6,#8*7	;一個字8筆資料, n個字共 8 x n 筆資料
FOURP:
		CJNE R3,#3,FIVEP
		MOV	DPTR,#TABLE4	;指標指到字型表開頭
		MOV	R6,#8*7	;一個字8筆資料, n個字共 8 x n 筆資料
FIVEP:
		
NEXT:		
		CLR	A		;清除累加器內資料
		MOVC	A,@A+DPTR	;讀取字型資料
		CALL	WRDR
		INC	DPTR		;指標內容加1, 指到下一行字型
		DJNZ	R6,NEXT
		RET
		
TABLE1:	
		DB	01110B		;1
		DB	01010B
		DB	01110B
		DB	00100B
		DB	00111B
		DB	00100B
		DB	00111B
		DB	11001B

		DB	00000B		;2
		DB	00000B
		DB	00000B
		DB	00011B
		DB	00100B
		DB	00011B
		DB	00001B
		DB	00010B
	
		DB	00000B		;3
		DB	00000B
		DB	00000B
		DB	11111B
		DB	00000B
		DB	11111B
		DB	00100B
		DB	00010B

		DB	00000B		;4
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	00000B		;5
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	00000B		;6
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	01110B		;7
		DB	01010B
		DB	01110B
		DB	00101B
		DB	00110B
		DB	00100B
		DB	11111B
		DB	11101B

TABLE2:	
		DB	01110B		;1
		DB	01010B
		DB	01110B
		DB	00100B
		DB	00111B
		DB	00100B
		DB	00111B
		DB	11001B

		DB	00000B		;2
		DB	00000B
		DB	00000B
		DB	01111B
		DB	10000B
		DB	01111B
		DB	00100B
		DB	01000B
	
		DB	00000B		;3
		DB	00000B
		DB	00000B
		DB	11100B
		DB	00000B
		DB	11100B
		DB	10000B
		DB	01000B

		DB	00000B		;4
		DB	00000B
		DB	00000B
		DB	11100B
		DB	11110B
		DB	11100B
		DB	00000B
		DB	00000B

		DB	00000B		;5
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	00000B		;6
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	01110B		;7
		DB	01010B
		DB	01110B
		DB	00101B
		DB	00110B
		DB	00100B
		DB	11111B
		DB	11101B

TABLE3:	
		DB	01110B		;1
		DB	01010B
		DB	01110B
		DB	00100B
		DB	00111B
		DB	00100B
		DB	00111B
		DB	11001B

		DB	00000B		;2
		DB	00000B
		DB	00000B
		DB	01111B
		DB	10000B
		DB	01111B
		DB	00100B
		DB	01000B
	
		DB	00000B		;3
		DB	00000B
		DB	00000B
		DB	11100B
		DB	00000B
		DB	11100B
		DB	10000B
		DB	01000B

		DB	00000B		;4
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	00000B		;5
		DB	00000B
		DB	00000B
		DB	11100B
		DB	11110B
		DB	11100B
		DB	00000B
		DB	00000B

		DB	00000B		;6
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	01110B		;7
		DB	01010B
		DB	01110B
		DB	00101B
		DB	00110B
		DB	00100B
		DB	11111B
		DB	11101B

TABLE4:	
		DB	01110B		;1
		DB	01010B
		DB	01110B
		DB	00100B
		DB	00111B
		DB	00100B
		DB	00111B
		DB	11001B

		DB	00000B		;2
		DB	00000B
		DB	00000B
		DB	01111B
		DB	10000B
		DB	01111B
		DB	00100B
		DB	01000B
	
		DB	00000B		;3
		DB	00000B
		DB	00000B
		DB	11100B
		DB	00000B
		DB	11100B
		DB	10000B
		DB	01000B

		DB	00000B		;4
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	00000B		;5
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B
		DB	00000B

		DB	00000B		;6
		DB	00000B
		DB	00000B
		DB	11100B
		DB	11110B
		DB	11100B
		DB	00000B
		DB	00000B

		DB	01110B		;7
		DB	01010B
		DB	01110B
		DB	00101B
		DB	00110B
		DB	00100B
		DB	11111B
		DB	11101B
;----------------------------------------------------------------------------


COMMAND:		CLR	LCD_RS		;寫命令到LCD副程式
		SETB	LCD_E
		MOV	LCD_DATA,A
		MOV	R7,#50		;延遲等訊號穩定
		DJNZ	R7,$
		CLR	LCD_E		;讓Enable接腳產生負緣訊號
		MOV	R7,#60		;延遲等訊號處裡完畢	
		DJNZ	R7,$
		RET

WRDR:		SETB	LCD_RS		;寫資料到LCD副程式
		SETB	LCD_E
		MOV	LCD_DATA,A
		MOV	R7,#50		;延遲等訊號穩定
		DJNZ	R7,$
		CLR	LCD_E		;讓Enable接腳產生負緣訊號
		MOV	R7,#60		;延遲等訊號處裡完畢	
		DJNZ	R7,$
		RET

DELAY:		MOV	R6,#100
DEL:		MOV	R7,#100
		DJNZ	R7,$
		DJNZ	R6,DEL
		DJNZ	R5,DELAY
		RET

		END